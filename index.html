<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pontuação - Gincana Escolar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --accent: #FF9800;
            --light: #f8f9fa;
            --dark: #343a40;
            --danger: #dc3545;
            --success: #28a745;
            --warning: #ffc107;
            --info: #17a2b8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #3d8b40;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-danger:hover {
            background-color: #bd2130;
        }
        
        .btn-secondary {
            background-color: var(--secondary);
        }
        
        .btn-secondary:hover {
            background-color: #1e87e0;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            background: #f0f0f0;
            border-radius: 4px 4px 0 0;
            margin-right: 0.25rem;
            margin-bottom: 0.5rem;
        }
        
        .tab.active {
            background: var(--primary);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            border-bottom: 1px solid #eee;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            font-weight: bold;
            color: var(--dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Public Ranking */
        .ranking {
            counter-reset: ranking;
        }
        
        .ranking-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: white;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .ranking-item::before {
            counter-increment: ranking;
            content: counter(ranking);
            background: var(--primary);
            color: white;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-right: 1rem;
            font-weight: bold;
        }
        
        .ranking-item:nth-child(1)::before {
            background: gold;
            color: #333;
        }
        
        .ranking-item:nth-child(2)::before {
            background: silver;
            color: #333;
        }
        
        .ranking-item:nth-child(3)::before {
            background: #cd7f32;
            color: white;
        }
        
        .ranking-team {
            flex-grow: 1;
            font-weight: 500;
        }
        
        .ranking-score {
            font-weight: bold;
            color: var(--primary);
        }
        
        /* Form Styles */
        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }
        
        .stat-icon.primary {
            background: rgba(76, 175, 80, 0.2);
            color: var(--primary);
        }
        
        .stat-icon.warning {
            background: rgba(255, 152, 0, 0.2);
            color: var(--accent);
        }
        
        .stat-icon.info {
            background: rgba(23, 162, 184, 0.2);
            color: var(--info);
        }
        
        .stat-icon.danger {
            background: rgba(220, 53, 69, 0.2);
            color: var(--danger);
        }
        
        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 0.2rem;
            color: var(--dark);
        }
        
        .stat-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Team Details */
        .team-details {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: #f9f9f9;
            border-radius: 8px;
        }
        
        .team-details.active {
            display: block;
        }
        
        .points-breakdown {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .points-breakdown th, .points-breakdown td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .points-breakdown th {
            background: #f0f0f0;
            font-weight: 600;
        }
        
        .points-breakdown tr:hover {
            background: #f5f5f5;
        }
        
        /* Events List */
        .events-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .event-card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .event-name {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .event-points {
            color: var(--accent);
            font-weight: 500;
        }
        
        .event-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            gap: 0.5rem;
        }
        
        .event-actions button {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }
        
        /* Teams Grid */
        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .team-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 1.5rem 1rem;
            text-align: center;
            transition: all 0.3s;
            position: relative;
        }
        
        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        
        .team-color {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
        }
        
        .team-color.red {
            background: #e53935;
        }
        
        .team-color.blue {
            background: #1e88e5;
        }
        
        .team-color.yellow {
            background: #fdd835;
            color: #333;
        }
        
        .team-color.green {
            background: #43a047;
        }
        
        .team-color.purple {
            background: #8e24aa;
        }
        
        .team-color.orange {
            background: #fb8c00;
        }
        
        .team-name {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .team-category {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        
        .team-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .team-actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .team-actions button {
            padding: 0.5rem;
            font-size: 0.8rem;
        }
        
        /* Categories Section */
        .categories-section {
            margin-bottom: 2rem;
        }
        
        .category-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }
        
        .category-header {
            border-bottom: 2px solid #eee;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--dark);
        }
        
        /* Login Screen */
        .login-container {
            display: none;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
        }
        
        .login-form {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }
        
        .login-form h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--dark);
        }
        
        .error-message {
            color: var(--danger);
            text-align: center;
            margin-top: 1rem;
            display: none;
        }
        
        /* Success Message */
        .success-message {
            background: var(--success);
            color: white;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
        }
        
        /* Warning Message */
        .warning-message {
            background: var(--warning);
            color: #333;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
        }
        
        /* Real-time Updates */
        .update-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--info);
            color: white;
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none;
            z-index: 1001;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                margin-right: 0;
                margin-bottom: 0.25rem;
            }
            
            .teams-grid, .events-list {
                grid-template-columns: 1fr;
            }
            
            .update-notification {
                top: 10px;
                right: 10px;
                left: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Update Notification -->
    <div class="update-notification" id="updateNotification">
        <i class="fas fa-sync-alt"></i> Sistema atualizado! Novos dados disponíveis.
    </div>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <h1>Sistema de Pontuação - Gincana Escolar</h1>
                <div class="user-info">
                    <div class="connection-status">
                        <div class="status-dot"></div>
                        <span id="connectionText">Conectado</span>
                    </div>
                    <span id="userStatus">Visitante</span>
                    <button id="adminLoginBtn">Acesso Admin</button>
                    <button class="logout-btn" id="logoutBtn" style="display: none;">Sair</button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <div class="container">
        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            <i class="fas fa-check-circle"></i> Pontos adicionados com sucesso!
        </div>
        
        <!-- Warning Message -->
        <div class="warning-message" id="warningMessage">
            <i class="fas fa-exclamation-triangle"></i> Pontos descontados com sucesso!
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="add-points">Adicionar Pontos</div>
            <div class="tab admin-only" data-tab="dashboard" style="display: none;">Dashboard</div>
            <div class="tab admin-only" data-tab="classification" style="display: none;">Classificação</div>
            <div class="tab admin-only" data-tab="events" style="display: none;">Eventos</div>
            <div class="tab admin-only" data-tab="teams" style="display: none;">Equipes</div>
            <div class="tab admin-only" data-tab="deduct-points" style="display: none;">Descontar Pontos</div>
        </div>
        
        <!-- Add Points Tab (Public) -->
        <div class="tab-content active" id="add-points-tab">
            <h2><i class="fas fa-plus-circle"></i> Adicionar Pontuação</h2>
            <div class="card">
                <div class="form-row">
                    <div class="form-group">
                        <label for="event"><i class="fas fa-calendar-alt"></i> Evento/Prova:</label>
                        <select id="event">
                            <option value="">Selecione um evento</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="team"><i class="fas fa-users"></i> Equipe:</label>
                        <select id="team">
                            <option value="">Selecione uma equipe</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="points"><i class="fas fa-star"></i> Pontos:</label>
                        <input type="number" id="points" min="1" placeholder="Quantidade de pontos">
                    </div>
                    <div class="form-group">
                        <label for="reason"><i class="fas fa-comment"></i> Motivo/Detalhes:</label>
                        <input type="text" id="reason" placeholder="Detalhes da pontuação">
                    </div>
                </div>
                <button onclick="addPoints()"><i class="fas fa-save"></i> Registrar Pontuação</button>
            </div>
            
            <!-- Visualização Pública da Classificação -->
            <div class="card">
                <div class="card-header">
                    <span><i class="fas fa-trophy"></i> Classificação Atual</span>
                    <small>Atualiza automaticamente</small>
                </div>
                <div class="ranking" id="publicRanking">
                    <!-- Será preenchido via JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Dashboard Tab (Admin Only) -->
        <div class="tab-content" id="dashboard-tab">
            <h2><i class="fas fa-tachometer-alt"></i> Dashboard Administrativo</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon primary">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalPoints">0</h3>
                        <p>Pontos Distribuídos</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon warning">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalTeams">0</h3>
                        <p>Equipes Participantes</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon info">
                        <i class="fas fa-calendar"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalEvents">0</h3>
                        <p>Eventos Realizados</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon danger">
                        <i class="fas fa-stopwatch"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="remainingEvents">0</h3>
                        <p>Eventos Restantes</p>
                    </div>
                </div>
            </div>
            
            <div class="categories-section">
                <h3><i class="fas fa-layer-group"></i> Classificação por Categoria</h3>
                
                <!-- Categoria 1 -->
                <div class="category-card">
                    <div class="category-header">Categoria 1 - Ensino Fundamental I (6º e 7º Anos)</div>
                    <div class="ranking" id="category1Ranking">
                    </div>
                </div>
                
                <!-- Categoria 2 -->
                <div class="category-card">
                    <div class="category-header">Categoria 2 - Ensino Fundamental II (8º e 9º Anos)</div>
                    <div class="ranking" id="category2Ranking">
                    </div>
                </div>
                
                <!-- Categoria 3 -->
                <div class="category-card">
                    <div class="category-header">Categoria 3 - Ensino Médio</div>
                    <div class="ranking" id="category3Ranking">
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span><i class="fas fa-history"></i> Atividades Recentes</span>
                    <button class="btn-secondary" onclick="forceSync()">
                        <i class="fas fa-sync-alt"></i> Sincronizar Agora
                    </button>
                </div>
                <div id="recentActivities">
                </div>
            </div>
        </div>
        
        <!-- Classification Tab (Admin Only) -->
        <div class="tab-content" id="classification-tab">
            <h2><i class="fas fa-trophy"></i> Classificação Detalhada</h2>
            <div class="card">
                <div class="ranking" id="rankingList">
                </div>
            </div>
        </div>
        
        <!-- Events Tab (Admin Only) -->
        <div class="tab-content" id="events-tab">
            <h2><i class="fas fa-calendar-plus"></i> Gerenciar Eventos</h2>
            <div class="card">
                <div class="card-header">
                    <span>Adicionar Novo Evento</span>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="newEventName">Nome do Evento:</label>
                        <input type="text" id="newEventName" placeholder="Ex: Corrida de Saco">
                    </div>
                    <div class="form-group">
                        <label for="newEventPoints">Pontuação Máxima:</label>
                        <input type="number" id="newEventPoints" min="1" placeholder="Pontos para o vencedor">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="newEventLocation">Local:</label>
                        <input type="text" id="newEventLocation" placeholder="Ex: Quadra esportiva">
                    </div>
                    <div class="form-group">
                        <label for="newEventTime">Horário:</label>
                        <input type="text" id="newEventTime" placeholder="Ex: 14:00">
                    </div>
                </div>
                <div class="form-group">
                    <label for="newEventDescription">Descrição:</label>
                    <textarea id="newEventDescription" placeholder="Descrição do evento" rows="3"></textarea>
                </div>
                <button onclick="addEvent()"><i class="fas fa-plus"></i> Adicionar Evento</button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span>Eventos da Gincana</span>
                </div>
                <div class="events-list" id="eventsList">
                </div>
            </div>
        </div>
        
        <!-- Teams Tab (Admin Only) -->
        <div class="tab-content" id="teams-tab">
            <h2><i class="fas fa-users-cog"></i> Gerenciar Equipes</h2>
            <div class="card">
                <div class="card-header">
                    <span>Adicionar Nova Equipe</span>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="newTeamName">Nome da Equipe:</label>
                        <input type="text" id="newTeamName" placeholder="Ex: Equipe Vermelha">
                    </div>
                    <div class="form-group">
                        <label for="newTeamColor">Cor da Equipe:</label>
                        <select id="newTeamColor">
                            <option value="red">Vermelho</option>
                            <option value="blue">Azul</option>
                            <option value="green">Verde</option>
                            <option value="yellow">Amarelo</option>
                            <option value="purple">Roxo</option>
                            <option value="orange">Laranja</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="newTeamCategory">Categoria:</label>
                    <select id="newTeamCategory">
                        <option value="1">Categoria 1 - Ensino Fundamental I (6º e 7º Anos)</option>
                        <option value="2">Categoria 2 - Ensino Fundamental II (8º e 9º Anos)</option>
                        <option value="3">Categoria 3 - Ensino Médio</option>
                    </select>
                </div>
                <button onclick="addTeam()"><i class="fas fa-plus"></i> Adicionar Equipe</button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span>Equipes Participantes</span>
                </div>
                <div class="teams-grid" id="teamsList">
                </div>
            </div>
        </div>
        
        <!-- Deduct Points Tab (Admin Only) -->
        <div class="tab-content" id="deduct-points-tab">
            <h2><i class="fas fa-minus-circle"></i> Descontar Pontos</h2>
            <div class="card">
                <div class="form-row">
                    <div class="form-group">
                        <label for="deductTeam">Equipe:</label>
                        <select id="deductTeam">
                            <option value="">Selecione uma equipe</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="deductPoints">Pontos a Descontar:</label>
                        <input type="number" id="deductPoints" min="1" placeholder="Quantidade de pontos">
                    </div>
                </div>
                <div class="form-group">
                    <label for="deductReason">Motivo:</label>
                    <input type="text" id="deductReason" placeholder="Motivo do desconto de pontos">
                </div>
                <button class="btn-danger" onclick="deductPoints()"><i class="fas fa-minus"></i> Descontar Pontos</button>
            </div>
        </div>
    </div>
    
    <!-- Admin Login Modal -->
    <div class="login-container" id="loginScreen">
        <div class="login-form">
            <h2><i class="fas fa-lock"></i> Acesso Administrativo</h2>
            <div class="form-group">
                <label for="username">Usuário:</label>
                <input type="text" id="username" placeholder="Digite seu usuário">
            </div>
            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" id="password" placeholder="Digite sua senha">
            </div>
            <button id="loginBtn"><i class="fas fa-sign-in-alt"></i> Entrar</button>
            <div class="error-message" id="errorMessage">
                <i class="fas fa-exclamation-circle"></i> Usuário ou senha incorretos!
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // CONFIGURAÇÃO DE SINCRONIZAÇÃO SIMULTÂNEA
        // =============================================
        
        // Dados iniciais
        let teams = {};
        let events = [];
        let currentUser = null;
        let lastUpdateTime = 0;
        let syncInterval;
        let isOnline = true;
        
        // Credenciais de administrador
        const adminCredentials = {
            username: "admin",
            password: "gincana2023"
        };
        
        // Cores disponíveis para equipes
        const teamColors = {
            'red': { name: 'Vermelho', class: 'red' },
            'blue': { name: 'Azul', class: 'blue' },
            'green': { name: 'Verde', class: 'green' },
            'yellow': { name: 'Amarelo', class: 'yellow' },
            'purple': { name: 'Roxo', class: 'purple' },
            'orange': { name: 'Laranja', class: 'orange' }
        };
        
        // Categorias
        const categories = {
            '1': 'Ensino Fundamental I (6º e 7º Anos)',
            '2': 'Ensino Fundamental II (8º e 9º Anos)',
            '3': 'Ensino Médio'
        };
        
        // Chave única para armazenamento compartilhado
        const STORAGE_KEY = 'gincana_escolar_shared_data_v2';
        
        // =============================================
        // SISTEMA DE SINCRONIZAÇÃO MELHORADO
        // =============================================
        
        // Carregar dados do localStorage compartilhado
        function loadData() {
            try {
                console.log('🔍 Carregando dados...');
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    teams = data.teams || {};
                    events = data.events || [];
                    lastUpdateTime = data.lastUpdateTime || 0;
                    console.log('✅ Dados carregados:', { 
                        teams: Object.keys(teams).length, 
                        events: events.length,
                        lastUpdate: new Date(lastUpdateTime).toLocaleTimeString()
                    });
                } else {
                    console.log('📝 Nenhum dado salvo encontrado, inicializando...');
                    initializeSampleData();
                }
            } catch (error) {
                console.error('❌ Erro ao carregar dados:', error);
                initializeSampleData();
            }
            updateUI();
        }
        
        // Salvar dados no localStorage compartilhado
        function saveData() {
            try {
                const data = {
                    teams: teams,
                    events: events,
                    lastUpdateTime: Date.now(),
                    savedBy: currentUser?.username || 'public',
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                lastUpdateTime = data.lastUpdateTime;
                
                console.log('💾 Dados salvos:', {
                    time: new Date().toLocaleTimeString(),
                    user: data.savedBy,
                    teams: Object.keys(teams).length
                });
                
                // Disparar evento customizado para notificar outras abas/janelas
                window.dispatchEvent(new CustomEvent('gincanaDataUpdated', {
                    detail: { 
                        timestamp: Date.now(),
                        source: 'saveData'
                    }
                }));
                
                // Também dispara um evento de storage (para outras abas)
                window.dispatchEvent(new StorageEvent('storage', {
                    key: STORAGE_KEY,
                    newValue: JSON.stringify(data),
                    oldValue: localStorage.getItem(STORAGE_KEY),
                    storageArea: localStorage,
                    url: window.location.href
                }));
                
            } catch (error) {
                console.error('❌ Erro ao salvar dados:', error);
                showConnectionError();
            }
        }
        
        // Verificar se há atualizações
        function checkForUpdates() {
            try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    if (data.lastUpdateTime > lastUpdateTime) {
                        console.log('🔄 Atualização detectada!', {
                            anterior: new Date(lastUpdateTime).toLocaleTimeString(),
                            nova: new Date(data.lastUpdateTime).toLocaleTimeString()
                        });
                        
                        // Dados foram atualizados por outra instância
                        teams = data.teams || {};
                        events = data.events || {};
                        lastUpdateTime = data.lastUpdateTime;
                        updateUI();
                        showUpdateNotification();
                        updateConnectionStatus(true);
                    }
                }
            } catch (error) {
                console.error('❌ Erro ao verificar atualizações:', error);
                updateConnectionStatus(false);
            }
        }
        
        // Sistema de notificação de atualização
        function showUpdateNotification() {
            const notification = document.getElementById('updateNotification');
            notification.innerHTML = '<i class="fas fa-sync-alt"></i> Dados atualizados!';
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Sistema de status de conexão
        function updateConnectionStatus(connected) {
            const statusDot = document.querySelector('.status-dot');
            const connectionText = document.getElementById('connectionText');
            
            if (connected) {
                statusDot.style.background = 'var(--success)';
                connectionText.textContent = 'Sincronizado';
                isOnline = true;
            } else {
                statusDot.style.background = 'var(--danger)';
                connectionText.textContent = 'Offline';
                isOnline = false;
            }
        }
        
        function showConnectionError() {
            const notification = document.getElementById('updateNotification');
            notification.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Erro de conexão!';
            notification.style.background = 'var(--danger)';
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
                notification.style.background = 'var(--info)';
            }, 3000);
        }
        
        // Forçar sincronização manual
        function forceSync() {
            console.log('🔄 Forçando sincronização...');
            checkForUpdates();
            showUpdateNotification();
        }
        
        // Iniciar sistema de sincronização
        function startSync() {
            console.log('🚀 Iniciando sistema de sincronização...');
            
            // Verificar atualizações a cada 1 segundo (mais rápido)
            syncInterval = setInterval(checkForUpdates, 1000);
            
            // Ouvir eventos de outras abas/janelas
            window.addEventListener('gincanaDataUpdated', function(event) {
                console.log('📡 Evento de atualização recebido:', event.detail);
                if (event.detail.timestamp > lastUpdateTime) {
                    checkForUpdates();
                }
            });
            
            // Ouvir eventos de storage (outras abas)
            window.addEventListener('storage', function(event) {
                if (event.key === STORAGE_KEY && event.newValue) {
                    console.log('💽 Evento de storage recebido de outra aba');
                    try {
                        const data = JSON.parse(event.newValue);
                        if (data.lastUpdateTime > lastUpdateTime) {
                            teams = data.teams || {};
                            events = data.events || {};
                            lastUpdateTime = data.lastUpdateTime;
                            updateUI();
                            showUpdateNotification();
                            updateConnectionStatus(true);
                        }
                    } catch (error) {
                        console.error('❌ Erro ao processar atualização:', error);
                    }
                }
            });
            
            // Verificar online/offline
            window.addEventListener('online', function() {
                console.log('🌐 Conexão restaurada');
                updateConnectionStatus(true);
                checkForUpdates();
            });
            
            window.addEventListener('offline', function() {
                console.log('📴 Conexão perdida');
                updateConnectionStatus(false);
            });
            
            // Verificação inicial
            updateConnectionStatus(navigator.onLine);
        }
        
        // Parar sistema de sincronização
        function stopSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
                console.log('🛑 Sistema de sincronização parado');
            }
        }
        
        // =============================================
        // INTERFACE DO USUÁRIO
        // =============================================
        
        // Atualizar a interface do usuário
        function updateUI() {
            // Atualizar dropdowns de eventos e equipes
            updateEventDropdown();
            updateTeamDropdowns();
            
            // Atualizar classificação pública
            updatePublicRanking();
            
            // Atualizar estatísticas (apenas para admin)
            if (currentUser) {
                document.getElementById('totalPoints').textContent = calculateTotalPoints();
                document.getElementById('totalTeams').textContent = Object.keys(teams).length;
                document.getElementById('totalEvents').textContent = events.filter(e => !e.isSystem).length;
                document.getElementById('remainingEvents').textContent = Math.max(0, 10 - events.filter(e => !e.isSystem).length);
                
                // Atualizar ranking detalhado
                updateRanking();
                
                // Atualizar atividades recentes
                updateRecentActivities();
                
                // Atualizar lista de eventos
                updateEventsList();
                
                // Atualizar lista de equipes
                updateTeamsList();
                
                // Atualizar classificações por categoria
                updateCategoryRankings();
            }
        }
        
        // Atualizar classificação pública
        function updatePublicRanking() {
            const publicRankingElement = document.getElementById('publicRanking');
            publicRankingElement.innerHTML = '';
            
            // Ordenar equipes por pontuação
            const sortedTeams = Object.entries(teams)
                .map(([id, team]) => ({ id, ...team }))
                .sort((a, b) => b.score - a.score)
                .slice(0, 5); // Mostrar apenas top 5
            
            if (sortedTeams.length === 0) {
                publicRankingElement.innerHTML = '<p style="padding: 1rem; text-align: center; color: #666;">Nenhuma pontuação ainda</p>';
                return;
            }
            
            sortedTeams.forEach(team => {
                const div = document.createElement('div');
                div.className = 'ranking-item';
                div.innerHTML = `
                    <span class="ranking-team">${team.name}</span>
                    <span class="ranking-score">${team.score} pts</span>
                `;
                publicRankingElement.appendChild(div);
            });
        }
        
        // Restante das funções de UI permanecem as mesmas...
        // [Manter todas as outras funções de UI do código anterior]
        
        // =============================================
        // FUNÇÕES PRINCIPAIS (mantidas do código anterior)
        // =============================================
        
        // Atualizar classificações por categoria
        function updateCategoryRankings() {
            updateCategoryRanking('1', 'category1Ranking');
            updateCategoryRanking('2', 'category2Ranking');
            updateCategoryRanking('3', 'category3Ranking');
        }
        
        function updateCategoryRanking(categoryId, elementId) {
            const rankingElement = document.getElementById(elementId);
            rankingElement.innerHTML = '';
            
            const categoryTeams = Object.entries(teams)
                .filter(([id, team]) => team.category === categoryId)
                .map(([id, team]) => ({ id, ...team }))
                .sort((a, b) => b.score - a.score);
            
            if (categoryTeams.length === 0) {
                rankingElement.innerHTML = '<p style="padding: 1rem; text-align: center; color: #666;">Nenhuma equipe</p>';
                return;
            }
            
            categoryTeams.forEach(team => {
                const div = document.createElement('div');
                div.className = 'ranking-item';
                div.innerHTML = `
                    <span class="ranking-team">${team.name}</span>
                    <span class="ranking-score">${team.score} pontos</span>
                `;
                rankingElement.appendChild(div);
            });
        }
        
        function updateEventDropdown() {
            const eventSelect = document.getElementById('event');
            eventSelect.innerHTML = '<option value="">Selecione um evento</option>';
            
            events.filter(e => !e.isSystem).forEach(event => {
                const option = document.createElement('option');
                option.value = event.id;
                option.textContent = event.name;
                eventSelect.appendChild(option);
            });
        }
        
        function updateTeamDropdowns() {
            const teamSelects = [
                document.getElementById('team'),
                document.getElementById('deductTeam')
            ];
            
            teamSelects.forEach(select => {
                if (select) {
                    select.innerHTML = '<option value="">Selecione uma equipe</option>';
                    
                    Object.keys(teams).forEach(teamId => {
                        const option = document.createElement('option');
                        option.value = teamId;
                        option.textContent = teams[teamId].name;
                        select.appendChild(option);
                    });
                }
            });
        }
        
        function calculateTotalPoints() {
            let total = 0;
            for (const teamId in teams) {
                total += teams[teamId].score;
            }
            return total;
        }
        
        function updateRanking() {
            const rankingListElement = document.getElementById('rankingList');
            rankingListElement.innerHTML = '';
            
            const sortedTeams = Object.entries(teams)
                .map(([id, team]) => ({ id, ...team }))
                .sort((a, b) => b.score - a.score);
            
            sortedTeams.forEach(team => {
                const div = document.createElement('div');
                div.className = 'ranking-item';
                div.setAttribute('data-team', team.id);
                div.innerHTML = `
                    <span class="ranking-team">${team.name} <small>(${categories[team.category]})</small></span>
                    <span class="ranking-score">${team.score} pontos</span>
                `;
                
                div.addEventListener('click', function() {
                    showTeamDetails(team.id);
                });
                
                rankingListElement.appendChild(div);
            });
        }
        
        function showTeamDetails(teamId) {
            const existingDetails = document.querySelector('.team-details');
            if (existingDetails) {
                existingDetails.remove();
            }
            
            const team = teams[teamId];
            
            const detailsDiv = document.createElement('div');
            detailsDiv.className = 'team-details active';
            detailsDiv.innerHTML = `
                <h3>Detalhes da Pontuação: ${team.name}</h3>
                <p><strong>Categoria:</strong> ${categories[team.category]}</p>
                ${team.pointsHistory.length > 0 ? `
                    <table class="points-breakdown">
                        <thead>
                            <tr>
                                <th>Tipo</th>
                                <th>Pontos</th>
                                <th>Motivo</th>
                                <th>Evento</th>
                                <th>Data/Hora</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${team.pointsHistory.map(item => `
                                <tr>
                                    <td>${item.type === 'deduction' ? '<span style="color: red;">Desconto</span>' : '<span style="color: green;">Adição</span>'}</td>
                                    <td>${item.type === 'deduction' ? '-' : '+'}${item.points}</td>
                                    <td>${item.reason}</td>
                                    <td>${item.eventName || 'N/A'}</td>
                                    <td>${item.timestamp}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                ` : '<p>Esta equipe ainda não recebeu pontos.</p>'}
            `;
            
            const rankingList = document.getElementById('rankingList');
            rankingList.parentNode.insertBefore(detailsDiv, rankingList.nextSibling);
        }
        
        function updateRecentActivities() {
            const recentActivitiesElement = document.getElementById('recentActivities');
            recentActivitiesElement.innerHTML = '';
            
            const allActivities = [];
            
            Object.keys(teams).forEach(teamId => {
                teams[teamId].pointsHistory.forEach(activity => {
                    allActivities.push({
                        ...activity,
                        teamName: teams[teamId].name,
                        teamId: teamId
                    });
                });
            });
            
            allActivities.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            const recentActivities = allActivities.slice(0, 5);
            
            if (recentActivities.length === 0) {
                recentActivitiesElement.innerHTML = '<p style="padding: 1rem; text-align: center; color: #666;">Nenhuma atividade registrada</p>';
                return;
            }
            
            recentActivities.forEach(activity => {
                const div = document.createElement('div');
                div.className = 'activity-item';
                const pointsText = activity.type === 'deduction' ? 
                    `perdeu <strong style="color: var(--danger);">${activity.points} pontos</strong>` : 
                    `recebeu <strong style="color: var(--success);">${activity.points} pontos</strong>`;
                    
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                        <div>
                            <strong>${activity.teamName}</strong> ${pointsText}
                            <div style="color: #666; font-size: 0.9rem;">${activity.reason} ${activity.eventName ? '- ' + activity.eventName : ''}</div>
                        </div>
                        <div style="color: #999; font-size: 0.8rem;">${activity.timestamp}</div>
                    </div>
                `;
                recentActivitiesElement.appendChild(div);
            });
        }
        
        function updateEventsList() {
            const eventsListElement = document.getElementById('eventsList');
            eventsListElement.innerHTML = '';
            
            const customEvents = events.filter(e => !e.isSystem);
            
            if (customEvents.length === 0) {
                eventsListElement.innerHTML = '<p style="padding: 1rem; text-align: center; color: #666;">Nenhum evento cadastrado</p>';
                return;
            }
            
            customEvents.forEach(event => {
                const eventCard = document.createElement('div');
                eventCard.className = 'event-card';
                eventCard.innerHTML = `
                    <div class="event-name">${event.name}</div>
                    <div class="event-points">${event.maxPoints} pontos para o vencedor</div>
                    <div>Local: ${event.location}</div>
                    <div>Horário: ${event.time}</div>
                    ${event.description ? `<div>Descrição: ${event.description}</div>` : ''}
                    <div class="event-actions">
                        <button class="btn-danger" onclick="deleteEvent('${event.id}')">Excluir</button>
                    </div>
                `;
                eventsListElement.appendChild(eventCard);
            });
        }
        
        function updateTeamsList() {
            const teamsListElement = document.getElementById('teamsList');
            teamsListElement.innerHTML = '';
            
            if (Object.keys(teams).length === 0) {
                teamsListElement.innerHTML = '<p style="padding: 1rem; text-align: center; color: #666;">Nenhuma equipe cadastrada</p>';
                return;
            }
            
            Object.keys(teams).forEach(teamId => {
                const team = teams[teamId];
                const teamCard = document.createElement('div');
                teamCard.className = 'team-card';
                teamCard.innerHTML = `
                    <div class="team-color ${team.color}">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="team-name">${team.name}</div>
                    <div class="team-category">${categories[team.category]}</div>
                    <div class="team-score">${team.score} pontos</div>
                    <div class="team-actions">
                        <button class="btn-danger" onclick="deleteTeam('${teamId}')">Excluir</button>
                    </div>
                `;
                teamsListElement.appendChild(teamCard);
            });
        }
        
        function addPoints() {
            const eventSelect = document.getElementById('event');
            const teamSelect = document.getElementById('team');
            const pointsInput = document.getElementById('points');
            const reasonInput = document.getElementById('reason');
            
            const eventId = eventSelect.value;
            const teamId = teamSelect.value;
            const points = parseInt(pointsInput.value);
            const reason = reasonInput.value;
            
            if (!eventId || !teamId || !points || !reason) {
                alert('Por favor, preencha todos os campos.');
                return;
            }
            
            const event = events.find(e => e.id === eventId);
            if (!event) {
                alert('Evento não encontrado.');
                return;
            }
            
            teams[teamId].score += points;
            
            teams[teamId].pointsHistory.push({
                type: 'addition',
                event: eventId,
                eventName: event.name,
                points: points,
                reason: reason,
                timestamp: new Date().toLocaleString()
            });
            
            saveData();
            updateUI();
            
            const successMessage = document.getElementById('successMessage');
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
            
            eventSelect.value = '';
            teamSelect.value = '';
            pointsInput.value = '';
            reasonInput.value = '';
        }
        
        function deductPoints() {
            const teamSelect = document.getElementById('deductTeam');
            const pointsInput = document.getElementById('deductPoints');
            const reasonInput = document.getElementById('deductReason');
            
            const teamId = teamSelect.value;
            const points = parseInt(pointsInput.value);
            const reason = reasonInput.value;
            
            if (!teamId || !points || !reason) {
                alert('Por favor, preencha todos os campos.');
                return;
            }
            
            if (teams[teamId].score < points) {
                alert('A equipe não possui pontos suficientes para este desconto.');
                return;
            }
            
            teams[teamId].score -= points;
            
            teams[teamId].pointsHistory.push({
                type: 'deduction',
                points: points,
                reason: reason,
                timestamp: new Date().toLocaleString()
            });
            
            saveData();
            updateUI();
            
            const warningMessage = document.getElementById('warningMessage');
            warningMessage.style.display = 'block';
            setTimeout(() => {
                warningMessage.style.display = 'none';
            }, 3000);
            
            teamSelect.value = '';
            pointsInput.value = '';
            reasonInput.value = '';
        }
        
        function addEvent() {
            const nameInput = document.getElementById('newEventName');
            const pointsInput = document.getElementById('newEventPoints');
            const locationInput = document.getElementById('newEventLocation');
            const timeInput = document.getElementById('newEventTime');
            const descriptionInput = document.getElementById('newEventDescription');
            
            const name = nameInput.value.trim();
            const points = parseInt(pointsInput.value);
            const location = locationInput.value.trim();
            const time = timeInput.value.trim();
            const description = descriptionInput.value.trim();
            
            if (!name || !points || !location || !time) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            const newEvent = {
                id: 'event_' + Date.now(),
                name: name,
                maxPoints: points,
                location: location,
                time: time,
                description: description,
                isSystem: false
            };
            
            events.push(newEvent);
            saveData();
            updateUI();
            
            nameInput.value = '';
            pointsInput.value = '';
            locationInput.value = '';
            timeInput.value = '';
            descriptionInput.value = '';
            
            alert('Evento adicionado com sucesso!');
        }
        
        function deleteEvent(eventId) {
            if (confirm('Tem certeza que deseja excluir este evento?')) {
                events = events.filter(e => e.id !== eventId);
                saveData();
                updateUI();
                alert('Evento excluído com sucesso!');
            }
        }
        
        function addTeam() {
            const nameInput = document.getElementById('newTeamName');
            const colorSelect = document.getElementById('newTeamColor');
            const categorySelect = document.getElementById('newTeamCategory');
            
            const name = nameInput.value.trim();
            const color = colorSelect.value;
            const category = categorySelect.value;
            
            if (!name) {
                alert('Por favor, informe o nome da equipe.');
                return;
            }
            
            const existingTeam = Object.values(teams).find(team => 
                team.name.toLowerCase() === name.toLowerCase()
            );
            
            if (existingTeam) {
                alert('Já existe uma equipe com este nome.');
                return;
            }
            
            const teamId = 'team_' + Date.now();
            teams[teamId] = {
                name: name,
                color: color,
                category: category,
                score: 0,
                pointsHistory: []
            };
            
            saveData();
            updateUI();
            
            nameInput.value = '';
            colorSelect.value = 'red';
            categorySelect.value = '1';
            
            alert('Equipe adicionada com sucesso!');
        }
        
        function deleteTeam(teamId) {
            if (confirm('Tem certeza que deseja excluir esta equipe? Todos os pontos serão perdidos.')) {
                delete teams[teamId];
                saveData();
                updateUI();
                alert('Equipe excluída com sucesso!');
            }
        }
        
        // =============================================
        // SISTEMA DE LOGIN E INTERAÇÃO
        // =============================================
        
        document.getElementById('adminLoginBtn').addEventListener('click', function() {
            document.getElementById('loginScreen').style.display = 'flex';
        });
        
        document.getElementById('loginBtn').addEventListener('click', function() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === adminCredentials.username && password === adminCredentials.password) {
                currentUser = { username: username, role: 'admin' };
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('userStatus').textContent = 'Administrador';
                document.getElementById('adminLoginBtn').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'block';
                
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = 'block';
                });
                
                loadData();
                startSync();
            } else {
                document.getElementById('errorMessage').style.display = 'block';
            }
        });
        
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('loginBtn').click();
            }
        });
        
        document.getElementById('logoutBtn').addEventListener('click', function() {
            currentUser = null;
            document.getElementById('userStatus').textContent = 'Visitante';
            document.getElementById('adminLoginBtn').style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'none';
            
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = 'none';
            });
            
            stopSync();
            switchTab('add-points');
        });
        
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                if (tab.classList.contains('admin-only') && !currentUser) {
                    document.getElementById('loginScreen').style.display = 'flex';
                    return;
                }
                
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }
        
        // =============================================
        // DADOS INICIAIS
        // =============================================
        
        function initializeSampleData() {
            if (!localStorage.getItem(STORAGE_KEY)) {
                console.log('🎯 Inicializando dados de exemplo...');
                
                events = [
                    {
                        id: 'event_quiz',
                        name: 'Quiz Cultural',
                        maxPoints: 150,
                        location: 'Auditório',
                        time: '15:30',
                        description: 'Competição de perguntas sobre cultura geral',
                        isSystem: false
                    },
                    {
                        id: 'event_corrida',
                        name: 'Corrida de Saco',
                        maxPoints: 100,
                        location: 'Quadra',
                        time: '14:00',
                        description: 'Corrida tradicional com sacos',
                        isSystem: false
                    },
                    {
                        id: 'event_danca',
                        name: 'Competição de Dança',
                        maxPoints: 200,
                        location: 'Ginásio',
                        time: '16:45',
                        description: 'Apresentações coreografadas',
                        isSystem: false
                    }
                ];
                
                teams = {
                    'team_6ano': {
                        name: '6º Ano',
                        color: 'red',
                        category: '1',
                        score: 320,
                        pointsHistory: [
                            { type: 'addition', event: 'event_quiz', eventName: 'Quiz Cultural', points: 120, reason: 'Segundo lugar', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_corrida', eventName: 'Corrida de Saco', points: 100, reason: 'Vencedora', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_danca', eventName: 'Competição de Dança', points: 100, reason: 'Participação', timestamp: new Date().toLocaleString() }
                        ]
                    },
                    'team_7ano': {
                        name: '7º Ano',
                        color: 'blue',
                        category: '1',
                        score: 280,
                        pointsHistory: [
                            { type: 'addition', event: 'event_quiz', eventName: 'Quiz Cultural', points: 150, reason: 'Primeiro lugar', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_corrida', eventName: 'Corrida de Saco', points: 80, reason: 'Segundo lugar', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_danca', eventName: 'Competição de Dança', points: 50, reason: 'Participação', timestamp: new Date().toLocaleString() }
                        ]
                    },
                    'team_8ano': {
                        name: '8º Ano',
                        color: 'green',
                        category: '2',
                        score: 450,
                        pointsHistory: [
                            { type: 'addition', event: 'event_quiz', eventName: 'Quiz Cultural', points: 150, reason: 'Primeiro lugar', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_corrida', eventName: 'Corrida de Saco', points: 100, reason: 'Vencedora', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_danca', eventName: 'Competição de Dança', points: 200, reason: 'Segundo lugar', timestamp: new Date().toLocaleString() }
                        ]
                    },
                    'team_9ano': {
                        name: '9º Ano',
                        color: 'yellow',
                        category: '2',
                        score: 380,
                        pointsHistory: [
                            { type: 'addition', event: 'event_danca', eventName: 'Competição de Dança', points: 200, reason: 'Primeiro lugar', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_quiz', eventName: 'Quiz Cultural', points: 150, reason: 'Participação', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_corrida', eventName: 'Corrida de Saco', points: 30, reason: 'Participação', timestamp: new Date().toLocaleString() }
                        ]
                    },
                    'team_1anoA': {
                        name: '1º Ano A',
                        color: 'purple',
                        category: '3',
                        score: 295,
                        pointsHistory: [
                            { type: 'addition', event: 'event_quiz', eventName: 'Quiz Cultural', points: 100, reason: 'Segundo lugar', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_danca', eventName: 'Competição de Dança', points: 150, reason: 'Menção honrosa', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_corrida', eventName: 'Corrida de Saco', points: 45, reason: 'Participação', timestamp: new Date().toLocaleString() }
                        ]
                    },
                    'team_1anoB': {
                        name: '1º Ano B',
                        color: 'orange',
                        category: '3',
                        score: 270,
                        pointsHistory: [
                            { type: 'addition', event: 'event_quiz', eventName: 'Quiz Cultural', points: 80, reason: 'Participação', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_corrida', eventName: 'Corrida de Saco', points: 90, reason: 'Terceiro lugar', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_danca', eventName: 'Competição de Dança', points: 100, reason: 'Participação', timestamp: new Date().toLocaleString() }
                        ]
                    },
                    'team_2anoA': {
                        name: '2º Ano A',
                        color: 'red',
                        category: '3',
                        score: 410,
                        pointsHistory: [
                            { type: 'addition', event: 'event_quiz', eventName: 'Quiz Cultural', points: 120, reason: 'Terceiro lugar', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_corrida', eventName: 'Corrida de Saco', points: 90, reason: 'Participação', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_danca', eventName: 'Competição de Dança', points: 200, reason: 'Primeiro lugar', timestamp: new Date().toLocaleString() }
                        ]
                    },
                    'team_2anoB': {
                        name: '2º Ano B',
                        color: 'blue',
                        category: '3',
                        score: 350,
                        pointsHistory: [
                            { type: 'addition', event: 'event_quiz', eventName: 'Quiz Cultural', points: 110, reason: 'Participação', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_corrida', eventName: 'Corrida de Saco', points: 140, reason: 'Vencedora', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_danca', eventName: 'Competição de Dança', points: 100, reason: 'Participação', timestamp: new Date().toLocaleString() }
                        ]
                    },
                    'team_3ano': {
                        name: '3º Ano',
                        color: 'green',
                        category: '3',
                        score: 390,
                        pointsHistory: [
                            { type: 'addition', event: 'event_quiz', eventName: 'Quiz Cultural', points: 130, reason: 'Participação', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_corrida', eventName: 'Corrida de Saco', points: 110, reason: 'Segundo lugar', timestamp: new Date().toLocaleString() },
                            { type: 'addition', event: 'event_danca', eventName: 'Competição de Dança', points: 150, reason: 'Terceiro lugar', timestamp: new Date().toLocaleString() }
                        ]
                    }
                };
                
                saveData();
            }
        }
        
        // =============================================
        // INICIALIZAÇÃO
        // =============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎉 Sistema de Gincana Escolar Iniciado!');
            initializeSampleData();
            loadData();
            startSync();
        });
    </script>
</body>
</html>